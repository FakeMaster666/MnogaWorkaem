<!DOCTYPE html>
<html lang="ru">

    <head>
        <meta charset="UTF-8">
        <title>Batteries & Experiments</title>
        <link rel="stylesheet" href="/static/style.css">
        <!-- <link rel="icon" type="image/x-icon" href="/favicon.ico"> -->
        <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    </head>
    
    <body>
        <h1>Battery Experiments Viewer</h1>
        
        <button id="backToTypes" type="button" style="display:none;">← Назад</button>
        <button id="showAllBatteriesBtn" type="button">Показать все батареи</button>
        <button id="colsToggle" type="button">Колонки</button>
        <span id="colsSummary"></span>

        <div id="colsPanel" style="display:none; border:1px solid #ccc; padding:10px; margin:10px 0;">
            <div><b>Выберите колонки, дополнительные к:</b> id, cell_name, batch, manufacturer, chemistry_family, capacity_nom, voltage_nom</div>
            <div id="colsGroups" style="margin-top:8px;"></div>

            <div style="margin-top:10px;">
                <button id="colsApply" type="button">Применить</button>
                <button id="colsReset" type="button">Сброс</button>
            </div>
        </div>

        <div class="table-wrap">
            <table id="batteriesTable">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="batteriesStatus"></div>

        <select id="batteriesLimit">
            <option value="10">10</option>
            <option value="20" selected>20</option>
            <option value="50">50</option>
        </select>

        <button id="batteriesPrev">←</button>
        <button id="batteriesNext">→</button>

        <div id="choiceModal">
            <div style="background:#fff; width:min(420px, 92vw); margin:12vh auto; padding:16px; border-radius:10px;">
                <div style="font-weight:600; margin-bottom:8px;">Выбор действия</div>
                <div id="choiceModalText" style="margin-bottom:12px;"></div>

                <div style="display:flex; gap:8px; justify-content:flex-end;">
                <button id="choiceOpenBatches" type="button">Открыть партии</button>
                <button id="choiceOpenBatteries" type="button">Открыть батарейки</button>
                <button id="choiceCancel" type="button">Отмена</button>
                </div>
            </div>
        </div>
        <!-- Batch choice modal -->
        <div id="batchChoiceModal"
            style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.35); z-index:2;"
            onclick="closeBatchChoiceModal()">
            <div style="background:#fff; width:min(420px, 92vw); margin:12vh auto; padding:16px; border-radius:10px;"
                onclick="event.stopPropagation()">
                <div style="font-weight:600; margin-bottom:8px;">Выбор действия</div>
                <div id="batchChoiceModalText" style="margin-bottom:12px;"></div>

                <div style="display:flex; gap:8px; justify-content:flex-end;">
                <button id="batchChoiceOpenBatteries" type="button">Батареи партии</button>
                <button id="batchChoiceOpenExperiments" type="button">Эксперименты партии</button>
                <button id="batchChoiceCancel" type="button" onclick="closeBatchChoiceModal()">Отмена</button>
                </div>
            </div>
        </div>

        <div id="topbar">    
            <div id="authArea">
                <button id="authBtn">Войти</button>

                <span id="userBox" class="hidden" style="align-items:center; gap:10px;">
                    <span id="userLogin"></span>
                    <button id="logoutBtn">Выйти</button>
                </span>
            </div>
        </div>


        <!-- Модалка -->
        <div id="authModal" class="modal hidden">
            <div class="modal__backdrop" id="authBackdrop"></div>
                <div class="modal__panel">
                    <div class="modal__header">
                    <div class="modal__tabs">
                        <button class="tab active" id="tabSignIn">Вход</button>
                        <button class="tab" id="tabSignUp">Регистрация</button>
                    </div>
                    <button class="modal__close" id="authClose">✕</button>
                </div>

                <div class="modal__body">
                    <div id="authError" class="error hidden"></div>

                    <!-- Вход -->
                    <form id="signInForm">
                        <label>
                            Логин
                            <input id="signInLogin" autocomplete="username" required minlength="3">
                        </label>
                        <label>
                            Пароль
                            <input id="signInPassword" type="password" autocomplete="current-password" required minlength="4">
                        </label>
                        <button type="submit">Войти</button>
                    </form>

                    <!-- Регистрация -->
                    <form id="signUpForm" class="hidden">
                        <label>
                            Логин
                            <input id="signUpLogin" autocomplete="username" required minlength="3">
                        </label>
                        <label>
                            Пароль
                            <input id="signUpPassword" type="password" autocomplete="new-password" required minlength="4">
                        </label>
                        <button type="submit">Зарегистрироваться</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="editModal" class="modal hidden">
            <div class="modal__backdrop" id="editModalBackdrop"></div>
            <div class="modal__panel">
                <div class="modal__header">
                    <div id="editModalTitle" class="modal__title">Edit battery</div>
                    <button id="editModalClose" class="btn">×</button>
                </div>

                <div id="editModalBody" class="modal__body"></div>

                <div class="modal__footer">
                    <div id="editModalError" class="modal__error"></div>
                    <button id="editModalSave" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>



        <script src="/static/main.js"></script>
    </body>
</html>